<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product | DJS Dope Designs</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">

  <!-- HEADER -->
  <header class="bg-black text-white p-4 flex justify-between items-center">
    <a href="index.html" class="text-xl font-bold">DJS Dope Designs</a>
    <button onclick="toggleCart()" class="relative">
      ðŸ›’
      <span id="cart-count" class="absolute -top-2 -right-2 bg-red-600 text-white text-xs rounded-full px-2">0</span>
    </button>
  </header>

  <!-- MAIN PRODUCT -->
  <main class="max-w-4xl mx-auto p-6">
    <div id="product-container" class="bg-white rounded-lg shadow-lg p-6 text-center"></div>
  </main>

  <!-- CART SIDEBAR -->
  <div id="cart-sidebar" class="fixed top-0 right-0 w-80 h-full bg-white shadow-lg transform translate-x-full transition-transform duration-300 p-6">
    <h2 class="text-xl font-bold mb-4">Your Cart</h2>
    <div id="cart-items" class="space-y-4"></div>
    <div id="cart-total" class="font-bold text-lg mt-4">Total: $0.00</div>
    <button onclick="checkout()" class="mt-4 w-full bg-green-600 text-white px-4 py-2 rounded">Checkout</button>
  </div>

  <script>
    let products = [];
    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    // Toggle cart sidebar
    function toggleCart() {
      const sidebar = document.getElementById("cart-sidebar");
      sidebar.classList.toggle("translate-x-full");
    }

    // Load products JSON + display selected product
    async function loadProduct() {
      const urlParams = new URLSearchParams(window.location.search);
      const slug = urlParams.get("slug");

      const res = await fetch("products.json");
      products = await res.json();

      const product = products.find(p => p.slug === slug);
      const container = document.getElementById("product-container");

      if (!product) {
        container.innerHTML = `<p class="text-red-500">Product not found.</p>`;
        return;
      }

      document.title = product.seoTitle + " | DJS Dope Designs";

      container.innerHTML = `
        <img src="${product.image}" alt="${product.name}" class="mx-auto max-h-96 object-contain mb-6 rounded-lg shadow">
        <h1 class="text-3xl font-bold mb-2">${product.name}</h1>
        <p class="text-gray-600 mb-4">${product.description}</p>
        <p class="text-xl font-semibold mb-6">$${(product.price/100).toFixed(2)}</p>
        <div class="flex justify-center space-x-4">
          <button onclick="addToCart('${product.slug}')" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Add to Cart</button>
          <button onclick="buyNow('${product.slug}')" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">Order Now</button>
        </div>
      `;
    }

    // ==== CART FUNCTIONS ====
    function addToCart(slug) {
      const product = products.find(p => p.slug === slug);
      if (!product) return;

      const existing = cart.find(item => item.slug === slug);
      if (existing) {
        existing.quantity += 1;
      } else {
        cart.push({ ...product, quantity: 1 });
      }

      saveCart();
      updateCartCount();
      renderCartItems();
      alert(`${product.name} added to cart!`);
    }

    function buyNow(slug) {
      addToCart(slug);
      window.location.href = "checkout.html"; // ðŸ‘ˆ update if your checkout page is different
    }

    function saveCart() {
      localStorage.setItem("cart", JSON.stringify(cart));
    }

    function updateCartCount() {
      document.getElementById("cart-count").textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
    }

    function renderCartItems() {
      const container = document.getElementById("cart-items");
      container.innerHTML = "";
      let total = 0;

      cart.forEach((item, index) => {
        total += item.price * item.quantity;
        const div = document.createElement("div");
        div.className = "flex items-center space-x-4";
        div.innerHTML = `
          <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-contain rounded">
          <div class="flex-1">
            <div class="font-medium">${item.name}</div>
            <div class="text-gray-500 text-sm">$${(item.price/100).toFixed(2)} x ${item.quantity}</div>
          </div>
          <button onclick="removeItem(${index})" class="text-red-500">âœ•</button>
        `;
        container.appendChild(div);
      });

      document.getElementById("cart-total").textContent = `Total: $${(total/100).toFixed(2)}`;
    }

    function removeItem(index) {
      cart.splice(index, 1);
      saveCart();
      updateCartCount();
      renderCartItems();
    }

    function checkout() {
      window.location.href = "checkout.html";
    }

    // ==== INIT ====
    loadProduct();
    updateCartCount();
    renderCartItems();
  </script>
</body>
</html>
