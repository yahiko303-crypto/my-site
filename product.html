<!DOCTYPE html>
<html lang="en" x-data="productPage()">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DjsDopeDesigns â€” Product</title>
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet">
<style>
  /* Optional: Smooth sliding cart */
  .cart-panel { transition: transform 0.3s ease-in-out; }
</style>
</head>
<body class="bg-gray-50 font-sans">

<!-- Header -->
<header class="sticky top-0 bg-white shadow z-50 flex justify-between items-center px-6 py-3">
  <a href="index.html" class="text-2xl font-bold text-gray-900">DjsDopeDesigns</a>
  <div class="flex items-center space-x-4">
    <input type="text" x-model="searchQuery" placeholder="Search products..." class="border rounded px-3 py-1 focus:outline-none focus:ring w-48">
    <button @click="toggleCart()" class="relative text-gray-700 text-2xl">ðŸ›’
      <span class="absolute -top-2 -right-3 bg-orange-500 text-white rounded-full px-2 text-xs" x-text="cartCount"></span>
    </button>
  </div>
</header>

<!-- Main product -->
<main class="max-w-6xl mx-auto px-4 py-8">
  <section class="flex flex-col md:flex-row md:space-x-8 items-center mb-12" x-show="mainProduct">
    <div class="flex-1">
      <img :src="mainProduct.image" :alt="mainProduct.name" class="w-full rounded-lg shadow-lg object-contain max-h-[400px]">
    </div>
    <div class="flex-1 mt-6 md:mt-0">
      <h1 class="text-3xl font-bold mb-2" x-text="mainProduct.name"></h1>
      <p class="text-xl text-gray-800 mb-4">$<span x-text="(mainProduct.price/100).toFixed(2)"></span></p>
      <p class="text-gray-700 mb-6" x-text="mainProduct.description"></p>
      <button @click="addToCart(mainProduct.id)" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition">Order Now ðŸ›’</button>
    </div>
  </section>

  <!-- Other Products -->
  <section>
    <h2 class="text-2xl font-bold mb-4">Other Products</h2>
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-6">
      <template x-for="product in filteredProducts()" :key="product.id">
        <div class="bg-white rounded-lg shadow p-4 flex flex-col">
          <img :src="product.image" :alt="product.name" class="w-full h-40 object-contain mb-3">
          <h3 class="font-semibold text-lg mb-1" x-text="product.name"></h3>
          <p class="text-gray-700 mb-3">$<span x-text="(product.price/100).toFixed(2)"></span></p>
          <div class="mt-auto flex space-x-2">
            <a :href="'product.html?id=' + product.id" class="flex-1 text-center bg-gray-200 text-gray-900 rounded py-1 hover:bg-gray-300 transition">View</a>
            <button @click="addToCart(product.id)" class="flex-1 bg-purple-600 text-white rounded py-1 hover:bg-purple-700 transition">Add</button>
          </div>
        </div>
      </template>
    </div>
  </section>
</main>

<!-- Sliding Cart Panel -->
<div class="fixed top-0 right-0 h-full w-80 bg-white shadow-lg transform translate-x-full cart-panel" x-bind:class="{'translate-x-0': cartOpen}">
  <div class="p-4 flex justify-between items-center border-b">
    <h2 class="text-xl font-bold">Your Cart</h2>
    <button @click="toggleCart()" class="text-gray-600 text-xl">&times;</button>
  </div>
  <div class="p-4 overflow-y-auto h-[calc(100%-64px)]">
    <template x-for="item in cartItems" :key="item.id">
      <div class="flex items-center mb-4">
        <img :src="item.image" :alt="item.name" class="w-16 h-16 object-contain rounded mr-3">
        <div class="flex-1">
          <h3 class="font-semibold" x-text="item.name"></h3>
          <p>$<span x-text="item.price.toFixed(2)"></span> Ã— <span x-text="item.quantity"></span></p>
        </div>
      </div>
    </template>
    <p x-show="cartItems.length===0" class="text-gray-500">Cart is empty</p>
  </div>
</div>

<script>
function productPage() {
  return {
    allProducts: [],
    mainProduct: null,
    searchQuery: '',
    cartItems: JSON.parse(localStorage.getItem("cart")) || [],
    cartOpen: false,
    cartCount: 0,
    init() {
      this.fetchProducts();
      this.updateCartCount();
    },
    fetchProducts() {
      fetch('products.json')
        .then(res => res.json())
        .then(products => {
          this.allProducts = products;
          const params = new URLSearchParams(window.location.search);
          const id = params.get('id') || products[0].id;
          this.mainProduct = products.find(p => p.id === id);
        });
    },
    filteredProducts() {
      if(!this.searchQuery) {
        return this.allProducts.filter(p => p.id !== this.mainProduct.id);
      }
      return this.allProducts.filter(p => 
        p.id !== this.mainProduct.id &&
        p.name.toLowerCase().startsWith(this.searchQuery.toLowerCase())
      );
    },
    addToCart(productId) {
      const product = this.allProducts.find(p => p.id === productId);
      if(!product) return;
      const existing = this.cartItems.find(i => i.id === productId);
      if(existing) existing.quantity++;
      else this.cartItems.push({id:product.id,name:product.name,price:product.price/100,quantity:1,image:product.image});
      localStorage.setItem("cart", JSON.stringify(this.cartItems));
      this.updateCartCount();
      alert(`${product.name} added to cart!`);
    },
    updateCartCount() {
      this.cartCount = this.cartItems.reduce((sum,i)=>sum+i.quantity,0);
    },
    toggleCart() {
      this.cartOpen = !this.cartOpen;
    }
  }
}
</script>

</body>
</html>
